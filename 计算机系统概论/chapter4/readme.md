# 冯诺依曼模型

- 基于决策单元和存储单元，可以描述一个简单的计算机模型，即冯·诺依曼模型

## 基本部件

- 计算机运行的前提

  - 任务描述,即计算机要完成的任务，以程序方式表述
  - 计算机本身运行能力，它是任务的具体执行者
  - 程序是计算机指令的集合，每条指令对应计算机一个基本动作，指令是程序的最小单位

- 冯诺依曼模型组成：内存、处理单元、输入、输出、控制单元

- 内存
  - 由门电路和锁存器组成，寻址空间就是内存容量，寻址能力就是每个单元能够存储的 bit 数量
  - 访问内存的第一步操作，是向内存提供被访问内存单元的地址
  - 读操作
    - 首先将被访问内存单元的地址放入 CPU 的内存地址寄存器 MAR，然后发送读信号通知内存，由此，内存将该单元中存放的数据传送至内存数据寄存器 MDR
  - 写操作
    - 首先将被访问的内存单元地址放入 MAR 寄存器，然后将要写入的数据放入 MDR 寄存器，最后向内存发送写信号，由此，MDR 的内容被写入 MAR 指向的内存单元
- 处理单元 ALU
  - 算术逻辑单元 ALU 能够完成基本算术运算和基本逻辑操作
  - ALU 所能处理的量化大小，通常被称为该计算机的字长，量化的基本单位是一个字，常见的字长有 8，16，32，64
  - 通常会在 ALU 附近配置少量寄存器，用于临时存储数据和中间计算值，寄存器的宽度和 ALU 处理数据的宽度一致
- 输入和输出单元
  - 通常称为外围设备，常见输入设备键盘，输出设备显示器
- 控制单元
  - 控制其他所有单元之间的协同工作，既负责控制程序执行过程的每一步，又负责控制其中每一条指令执行过程的每一步
  - 特殊寄存器
    - 指令寄存器 IR，保存正在被执行的指令
    - 程序计数器 PC，指示下一条待处理的指令地址

## LC-3 一台冯诺依曼机器

- 内存：
  - 包括存储单元以及 MAR 和 MDR 寄存器
  - MAR 是 16 位，表示最大寻址空间 2^16
  - MDR 是 16 位，每个存储单元存储了 16bit 的信息
- 输入输出
  - 键盘需要两个寄存器，数据寄存器 KBDR 保存输入的 ASCII 码，状态寄存器 KBSR 保存键盘敲击的状态信息
  - 显示器需要两个寄存器，数据寄存器 DDR 保存显示字符的 ASCII 码，状态寄存器 DSR 保存相关的状态信息
- 处理单元
  - 包括一个算术逻辑运算单元 ALU 和 8 个寄存器 R0~R7
  - R0~R7 作为临时寄存器，用以存放近期将被后面指令使用的操作数
- 控制单元
  - 包含所有与信息控制相关的结构，最重要的一个结构就是有限状态机 FSM，它控制系统中所有的活动

## 指令处理

- 核心思想: 程序和数据都是以 bit 流的方式存放在计算机内存中，程序在控制单元的控制下，依次完成指令的读取和执行

- 指令
  - 指令是计算机执行的最小单位，指令由操作码和操作数组成，操作码表示该指令是做什么的，操作数表示该次操作的对象是哪些
- 指令周期
  - 指令周期指的是指令在控制单元下一步一步执行的过程
  - 每一步称为节拍，一个指令包括 6 个节拍，即 FETCH 取指令，DECODE 译码，EVALUATE ADDRESS 地址计算，FETCH OPERAND 取操作数，EXECUTE 执行，STORE RESULT 存放结果
    - 取指令
      - 将 PC 寄存器的内容装入 MAR 寄存器
      - 该地址对应内存单元的内容(下一条指令)被装入 MDR
      - 控制单元将 MDR 内容装入 IR 寄存器
      - 修改 PC 寄存器的内容，指向下一条指令
    - 译码
      - 分析检查指令的类型，并确定对应的微结构操作细节
    - 地址计算
      - 如果指令执行时存在地址计算机操作，在此节拍完成
    - 取操作数
      - 读取指令处理所需要的源操作数
        - 将之前地址计算节拍算出的地址值装入 MAR 寄存器
        - 从 MDR 寄存器获取读自内存的源操作数
    - 执行
      - 指令的执行操作
    - 存放结果
      - 之前节拍的执行结果被写入目的寄存器

## 改变执行顺序

- 指令的种类：运算指令、数据搬移指令、控制指令
- 控制指令作用是改变程序的执行顺序
- 具体操作:

  - 在把 PC 加 1 操作之后与下一条指令的取指令节拍开始之前的这段时间内，修改程序计数器 PC 的值
  - 控制指令即在指令的执行节拍修改 PC 的内容覆盖 PC 的值

- 指令周期的控制
  - 机器周期等同于时钟周期
  - 取指令需要三个时钟周期
    - 有限状态机的起始状态是状态 1，在第一个时钟周期内，第一步操作: 将 PC 内容装入 MAR 寄存器，第二步操作:PC 自增
    - 第二个时钟，有限状态机进入状态 2，开始操作:读内存，并将内容返回数据自动装入 MDR
    - 状态 3: 第三个时钟，将 MDR 中的数据拷贝至指令寄存器 IR
  - 译码需要一个时钟周期
    - 在状态 4 中，基于 IR 的输入，尤其是该指令的操作码部分，预先状态极的转移出现不同分支去向

## 停机操作

- 停止时钟，意味终止指令的指令
- 时钟电路
  - 结构:时钟信号发生器和 RUN 状态开关
  - 时钟信号发生器主要部件是晶振，输入电压，产生振荡，在一个机械周期内，前半周保持 2.9V，后半周落至 0V
  - RUN 搜存器的状态或输出如果是 1，时钟电路输出和时钟信号发生器一致，否则时钟电路被切断
