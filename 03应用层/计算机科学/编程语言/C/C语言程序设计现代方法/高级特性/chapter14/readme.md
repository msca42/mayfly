# 预处理器

- 在编译前处理 C 程序，C 和 C++独有

## 预处理器的工作原理

- #define:
  - 定义一个宏，用来表示其他东西的名字
  - 预处理器会将宏的名字和定义存储在一起，当程序中使用到宏时，将定义进行替换
- #include:
  - 告诉与处理器打开一个特定文件，将它的内容作为正在编译的文件的一部分包含起来
- 工作原理
  - 引入.h 内容来响应#include 命令
  - 删除#define 指令，并替换用数值替代宏
  - 将注释替换为空白字符
- 显示输出
  - 通过 gcc -E 可以显示预处理后的代码

## 预处理指令

- 三种类型
  - 宏定义
    - #define 定义一个宏
    - #undef 删除一个宏
  - 文件包含
    - #include 将指定文件包含在程序中
  - 条件编译
    - #if 等 根据预处理器可以测试的条件确定，是将文本块纳入程序还是排除在外
- 指令规则
  - 以#开始，不需要在行首，只需要它之前有空白字符即可，在#之后是指令名，接着是指令所需的其他信息
  - 指令的符号之间可以插入任意数量的空格和水平制表符
  - 指令总是在第一个换行符处结束，如果要延续需要在行末加上\
  - 指令可以出现在程序的任何地方
  - 注释和指令可以在同一行

## 宏定义

- 宏可以分为简单宏和带参数的宏
  - 简单的宏
    - 格式: #define 标识符 替换列表
    - 替换列表
      - 一系列的预处理记号
      - 包含标识符、关键字、数值常量、字符常量、字面串、运算符和标点符号
      - 当预处理器遇到宏定义时，会做一个记录，将标识符用替换列表代替
    - 作用
      - 用于定义明示常量，诸如数值、字符值或字符串值
      - 对 C 语言语法规则进行修改，类似取别名，通常不建议
      - 对类型进行重命名，不建议使用，因为最佳实践时类型定义
      - 控制条件编译
  - 带参数的宏
    - 格式: #define 标识符(x1,x2) 替换列表
    - 作用
      - 通常作为简单函数
    - 优点
      - 宏没有额外开销，所以运行速度会快一点
      - 宏的参数没有类型，可以接收任何参数
    - 缺点
      - 编译后的代码变大
      - 没有类型检查和类型转换
      - 无法使用指针
      - 多次计算参数，可能会产生副作用
- #运算符
- ##运算符
- 宏定义可以包含两个专用运算符
- 运算符
- 宏的通用属性
- 宏定义中的圆括号
- 创建较长的宏
- 预定义宏
- C99 中新增的预定义宏
- 空的宏参数
- 参数个数可变的宏
- *func*标识符

## 条件编译

- #if 指令和#endif 指令
- defined 运算符
- #ifdef 指令和#ifndef 指令
- #elif 指令和#else 指令
- 使用条件编译

## 其他指令

- #error 指令
- #line 指令
- #pragma 指令
- \_Pragma 运算符
