# 模式匹配与正则表达式

## 补充说明

- 可以将正则学习分为三个阶段
  - 第一阶段: 熟练使用
    - 文本处理直觉
    - 《正则表达式必知必会》
  - 第二阶段: 了解机制
    - 有限状态机概念
    - 《精通正则表达式》
  - 第三阶段: 掌握原理
    - 形式语言理论
    - 《自动机理论、语言和计算导论》
- 通常只需要达到第二阶段

## 不用正则表达式来查找文本模式

- 需要按照各种条件依次判断，繁琐

## 用正则表达式查找文本模式

- 正则表达式简称 regex，是文本模式的描述方法
- 创建正则对象步骤
  - 导入模块 import re
  - 调用函数传入正则表达式 re.compile("regex")
    - 参数是正则表达式
    - 返回一个 Regex 模式对象
  - 匹配 Regex 对象 Regex 对象调用 search()方法
    - 参数是原始字符串
    - 目的是在原始字符串中匹配是否与正则表达式相同的字符集合
      - 没有匹配返回 None
      - 匹配返回 Match 对象，包含被查找字符串中的“第一次”匹配的文本
  - Match 对象的 group()方法 返回实际匹配文本

## 用正则表达式匹配更多模式

- 利用括号分组
  - 通过添加括号在正则表达式中创建分组
  - group()方法的参数可以精确第几个分组
    - 返回列表
    - 0 默认是全部分组
    - 1 默认第一个分组
  - groups() 获取所有分组
    - 返回多个值的元组
- 用管道匹配多个分组
  - 管道｜ 用于匹配许多表达式中的一个
- 用问号实现可选匹配
  - 问号之前的括号内容可以出现零次或一次
- 用星号匹配零次或多次
  - - 之前的分组可以出现任意次
- 用加号匹配一次或多次
- 用花括号匹配特定次数
  - 还可以匹配一个指定范围，参数是最小值，逗号，最大值

## 贪心和非贪心匹配

- Python 默认贪心匹配，在存在二义的情况下，尽可能匹配最长的字符串
- 非贪心模式: 花括号之后跟着一个问号

## findall()方法

- 在没有分组的情况下，返回一组字符串(**字符串列表**)，包含被查找字符串中的“所有”匹配文本
- 在存在分组的情况下，返回**元组**的列表，其中的项就是正则表达式中每个分组的匹配字符串

## 字符分类

- \d: 0~9 的任何数字
- \D: 除 0 ～ 9 的数字以外的任何字符
- \w: 任何字母、数字或下划线字符
- \W: 除字母、数字和下划线以外的任何字符
- \s: 空格、制表符或换行符
- \S: 除空格、制表符和换行符以外的任何字符
- 字符分类[a-b] 匹配 a~b

## 建立自己的字符分类

- 使用方括号定义自己的字符分类
  - 在方括号内，普通正则表达式符号不会被解释
  - 在左方括号后加上一个插入字符^,就可以得到非字符类,匹配不在这个字符类中的所有字符
- 使用短横线表示字母或数字范围

## 插入字符和美元符号

- 插入字符^: 表示匹配必须发生在被查找文本开始处
- 美元符号$: 表示字符串必须以这个正则表达式模式结束

## 通配字符

- 通配字符: .句点,匹配换行符之外的所有字符
- 点星匹配除换行符所有字符: .\*
- 点星匹配所有字符: 将 re.DOTALL 作为参数传入 re.compile()的第二个参数

## 正则表达式符号复习

## 不区分大小写的匹配

- 参数 re.IGNORECASE 或 re.I

## 用 sub()方法替换字符串

- Regex 对象的 sub 方法
  - 参数 1 用于替换发现匹配的字符串
  - 参数 2 正则表达式
  - 返回值 替换后的字符串

## 管理复杂的正则表达式

- 忽略空白符和注释 re.VERBOSE

## 组合使用 re.IGNORECASE、re.DOTALL 和 re.VERBOSE

- 使用管道字符｜将参数组合在一起

## 项目: 电话号码和 E-mail 地址提取程序

- 在剪贴板的文本中查找电话号码和 E-mail 地址并替换

## 小结

- re 模块可以编译 Regex 对象
- search()方法查找单词匹配
- findall()方法查找所有匹配实例
- sub()方法对文本进行查找和替换

## 习题

- re.compile()
- 更方便、更清晰地处理正则表达式中的特殊字符和转义字符
- 查找单词匹配
- group()
- 0: 完整、1 第一个 2 第二个
- 使用\
- 是否分组
- 管道
- 可选 0 次或一次
- 0 次和 1 次的区别
- 后者最多 5 次
- 数字、任何字母数字下划线、空格
- 非数字、非任何字母数字下划线、非空格
- 非换行任何字符和可选任何字符
- \w
- re.I
- 非换行任何字符 任何字符
- X drummers, X pipers, five rings, X hens
- 注释
- ^\d{1,3}(,\d{3})\*$
- ^[A-Z][a-zA-Z]\* Nakamoto$
- ^(Alice|Bob|Carol) (eats|pets|throws) (apples|cats|baseballs)\.$

## 实践项目

- 日期检测
- 强口令检测
- strip()的正则版本
