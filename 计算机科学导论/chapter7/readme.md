# 操作系统

## 引言

- 计算机系统可以分为硬件和软件
  - 计算机软件可以分为操作系统和应用程序
  - 应用程序使用计算机硬件来解决用户问题
  - 操作系统控制计算机系统对用户硬件的访问
- 操作系统
  - 定义: 计算机硬件和用户(程序和人)的一个接口，它使得其他程序更加方便有效地运行，并能方便地对计算机硬件和软件资源进行访问
  - 设计目标:
    - 有效使用
- 自举过程
  - 所有程序都需要装入内存中才能运行，操作系统为其他程序提供支持，ROM 为操作系统提供支持，将其存储在内存中
  - 解决方案采用两阶段
    - ROM 内存中，加电时自举程序启动，CPU 计数器被设置为自举程序的第一条指令，作用就是把操作系统装入 RAM 内存
    - 装入完成后，CPU 中的程序计数器就被设置为 RAM 中操作系统第一条指令，操作系统就被执行了

## 演化

- 批处理系统
  - 20 世纪 50 年代，目的是控制大型计算机，只要保证计算机所有资源从一个作业转换到另一个作业
  - 作业: 每个运行的程序
  - 此时计算机十分庞大，用穿孔卡片进行输入数据，用行式打印机输出结果，用磁带设备作为辅助存储介质
- 分时系统
  - 引入多道程序的概念，可以将多个作业同时装入内存，并且进当该资源可用时分配给需要它的作业
  - 多道程序带来了分时的概念，资源被不同的作业共享，每个作业分到一段时间，但是由于计算机运行速度很快，对于用户来说分时系统是隐藏的
  - 分时系统带来了新的需求: 给不同程序分配资源并决定哪个程序什么时候使用哪种资源。一个作业是一个要运行的程序，一个进程是内存中等待分配资源的程序。
- 个人系统
  - 单用户操作系统诞生，类似 DOS
- 并行系统
  - 在同一个计算机中安装多个 CPU，每个 CPU 可以处理一个程序，并行系统取代串行系统
- 分布式系统
  - 程序的执行从单台计算机扩大到多台计算机
- 实时系统
  - 实时系统是指在特定时间限制内完成任务

## 组成部分

- 现代操作系统至少具有四种功能: 存储管理、进程管理、设备管理、文件管理
- 操作系统与外界通信的组件称为用户界面或命令解释程序
- 用户界面
  - 用来接收进程的输入并向操作系统解释这些请求程序
  - Unix 的用户界面称为命令解释程序 shell,在其他操作系统中称为窗口
- 内存管理器
  - 操作系统按照内存管理可以分为单道程序和多道程序
  - 单道程序
    - 大多数内存用来装载单一的程序，少部分用来装载操作系统
    - 工作流程: 程序装入内存，运行，装入新的程序
    - 缺点：
      - 程序装载受限于内存容量
      - 输入输出限制 CPU 运行
  - 多道程序
    - 同一时刻可以装入多个程序并且能够同时被执行，CPU 轮流为其服务
    - 模式分类
      - 非交换技术: 程序运行期间始终驻留内存
        - 分区
          - 内存被划分为几个分区，每个分区装载一个程序，CPU 在不同分区之间服务
          - 缺点:
            - 分区大小由内存管理器决定，分区小了无法装载程序，分区大了出现空闲区
            - 空闲区过多需要内存管理器紧缩分区并删除空闲区，增加系统开销
        - 分页
          - 内存被划分大小相等的帧，程序被划分大小相等页，页和帧的大小一样
          - 优点:
            - 程序无需等待内存中出现连续的空闲即可加载运行
      - 交换技术: 运行期间程序在内存和硬盘之间多次交换数据
        - 请求分页
          - 在分页的基础上改进了无需完全加载整个程序才能运行
          - 单独加载页进内存即可运行，然后交换页
          - 内存可以同时加载多个程序的页
        - 请求分段
          - 程序被分为主程序段和子程序段等，内存被分为等长的段
  - 虚拟内存
    - 在请求分页、请求分段的机制下，在较小的实际内存运行远超该内存的程序，程序所需的内存容量称为虚拟内存
- 进程管理器
  - 程序: 由程序员编写的一组稳定的指令，存在磁盘上
  - 作业: 从一个程序被选中执行，到其运行结束并再次成为一个程序的这段过程，该程序称为作业
  - 进程: 一个运行中的程序，是一个在内存中运行的作业
  - 调度器
    - 进程管理器使用两个调度器: 作业调度器和进程调度器
    - 作业调度器将作业从保持状态转入就绪状态(创建进程)或者从运行状态转入终止状态(终止进程)
    - 进程调度器将一个进程从一个状态转入另一个状态，进程可以分为就绪状态、运行状态和等待状态
  - 队列
    - 进程使用队列管理作业和进程，队列中存储的是作业控制块和进程控制块，常见队列: 作业队列、就绪队列、IO 队列
  - 进程同步
    - 进程管理的思想是使得拥有不同资源的不同进程同步
    - 进程同步过程中会出现两个问题: 死锁和饿死
    - 死锁
      - 两个或多个进程在执行过程中，由于竞争资源而产生的一种阻塞现象
      - 必要条件
        - 互斥: 一个资源只能一个进程占有
        - 资源占有: 一个进程占有一个资源，即使在获取其他资源之前无法使用它
        - 抢先: 操作系统不能临时对资源重新分配
        - 循环等待: 所有进程和资源包含在一个循环里
    - 饿死
      - 操作系统对进程分配资源限制过多时发生
- 设备管理器

  - 负责访问输入输出设备
  - 常见功能:
    - 不停监视所有的输入/输出设备，保证正常运行
    - 为每个输入/输出设备维护一个队列
    - 控制用于访问输入/输出设备的不同策略

- 文件管理器
  - 控制对文件的访问
  - 常见功能
    - 控制文件的访问
    - 管理文件的创建、删除和修改
    - 给文件命名
    - 管理文件的存储
    - 归档和备份

## 主流操作系统

- Unix
  - 特点
    - 由 C 语言编写，可移植
    - 拥有一套命令工具
    - 设备无关性
  - 多用户、多道程序、可移植的操作系统，被设计来方便编程、文本处理、通信
  - 结构
    - 组成: 内核、命令解释器、一组标准的工具和应用程序
    - 内核
      - 包含操作系统最基本的部分: 内存管理、进程调度、设备管理和文件管理
    - 命令解释器
    - 工具
      - 常见工具: 文本编辑器、搜索程序和排序程序
    - 应用
      - 系统管理员、专职程序员或用户编写的，提供对系统的扩展能力
- Linux
  - 组成:内核、系统库、系统工具
  - 网络功能: 套接字接口、协议驱动和网络设备驱动
  - 安全: 提供为 Unix 定义的安全特性
- Windows
  - 设计目标: 可扩展性、可移植性、兼容性、性能
  - 体系结构
    - 分为三层: 硬件、内核态、用户态
    - 内核态组成
      - 硬件抽象层 HAL： 为上层隐藏硬件的差异
      - 内核: 操作系统的心脏
      - 执行者: 为整个操作系统提供服务
        - 组成: 对象管理器、安全引用监控、进程管理器、虚拟内存管理器、本地过程调用工具和 I/O 管理
    - 用户态组成
      - 环境子系统

## 总结

- 理解操作系统在计算机中的作用
- 给出操作系统的定义
- 理解吧操作系统调入内存的自举过程
- 列出操作系统的组成部分
- 讨论操作系统的中内存管理器的作用
- 讨论操作系统的中进程管理器的作用
- 讨论操作系统的中设备管理器的作用
- 讨论操作系统的中文件管理器的作用
- 理解三种常见的操作系统的主要特点:UNIX、Linux 和 Windows NT
