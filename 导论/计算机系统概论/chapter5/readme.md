# LC-3 结构

- 介绍 LC-3 的指令集架构 ISA

## ISA 概述

- ISA 定义了软件编程所需的必要而完整的描述，也就是说 ISA 向以机器语言编程的程序员提供有关控制机器所需要的所有必要信息
- ISA 给出了内存组织方式、寄存器组、指令集(包括操作码、数据类型、寻址模式)等信息
- 内存组织
  - 寻址空间 2^16,寻址基本单位 16 位，即一个字为 16 位
- 寄存器
  - 直接从内存获取数据速度很慢，通过通用寄存器提供临时存储空间，访问速度是一个周期
  - 寄存器和内存的特性是一样的
    - 记忆特性: 可以存储信息并可被再次读出，每个寄存器的存储大小是一个字
    - 独立寻址，每个寄存器必须有独立的唯一标识
- 指令集

  - 一条指令可以分为两个部分:操作码和操作数
  - 一个 ISA 的指令集定义包括:操作码的集合，数据类型和寻址模式，其中寻址模式决定操作数的存放位置

- 操作码
  - 操作数从属于 ISA，不同的 ISA 具有不同的操作码
- 数据类型
  - 数据类型是信息的表达方式，意味着 ISA 的操作码是如何理解这些信息的
  - 如果 ISA 的操作码能够识别，处理某种数据类型的信息，我们称该 ISA 支持这种数据类型
- 寻址模式
  - 定义操作数位置的一种机制
  - 操作数的位置:内存、寄存器、指令
  - 我们称存在于指令之中的操作数为字面值或立即数
  - LC-3 支持五种寻址模式: 立即数、寄存器以及三种内存寻址模式，即相对寻址，间接寻址，基址寻址
- 条件码
  - 前提: ISA 的一个特性,基于之前指令的执行结果来改变指令执行序列
  - 特性机制: 条件码
  - LC-3 具有三个位寄存器对应 8 个通用寄存器，当通用寄存器被修改或写入时，三个单 bit 位就会发生改变(置 1 或清零)，我们称这三个单 bit 寄存器为条件码

## 操作指令

- 操作指令时处理数据的指令，运算操作(加/减/乘/除) 和 逻辑操作(与/或/非/异或)都属于操作指令
- LC-3 操作指令格式
  - NOT
    - 采用寄存器寻址模式
      - 允许处理器直接访问和操作寄存器中数据，而非从内存中加载数据
    - 操作码 4bit: 1001
    - 目的寄存器 3bit: 011
    - 源寄存器 3bit: 101
    - 填充位 6bit: 111111
  - ADD&AND
    - 可以采用寄存器方式或立即数方式
    - 操作码 4bit: ADD 0001、 AND 0101
    - 目的操作数 3bit: 001
    - 源操作数 3bit: 100
    - 寻址方式 1bit: 0
    - 填充位 2bit: 00
    - 寄存器: 101

## 数据搬移指令

- 作用:在通用寄存器和内存之间，寄存器和输入/输出设备之间搬动数据
- 装载 load: 从内存移入寄存器； 存储 store: 从寄存器转入内存；
- 格式:
  - 操作码: 4bit
  - DR 或 SR: 3bit, 寄存器，如果是 load 指令代表 DR，表示指令周期结束后，内存内容被写入该寄存器；如果是 store 指令代表 SR，表示该寄存器的内容被写入内存
  - 地址生成位: 8bit， 基于地址生成位可以计算第二个操作数的 16 位地址
- LC-3 有四种地址生成的方法
  - PC 相对寻址
    - 8bit 表示相对当前 PC 的偏移量，计算方法，将 8bit 内容做 16 位的扩展，然后与 PC 至相加

## 控制指令

## 例子: 字符数统计

## 总结: 数据通路
